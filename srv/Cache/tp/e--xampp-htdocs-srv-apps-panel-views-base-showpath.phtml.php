<style>
    .inner-nav {
        background-color: #efeef0;
    }

    .Hui-tabNav {
        height: 35px;
        padding-right: 85px;
        overflow: hidden;
        position: relative;
        background-color: #efeef0;
        background-repeat: repeat-x;
        background-position: 0 -175px;
    }

    .acrossTab li.active {
        background-position: 0 -120px;
        z-index: 99;
    }

    .Hui-tabNav, .Hui-tabNav .acrossTab li, .Hui-tabNav .acrossTab li em {
        background-image: url(/srv/static/panel/images/acrossTab-2.png);
    }

    .acrossTab li em {
        position: absolute;
        width: 23px;
        height: 29px;
        right: -20px;
        top: 0;
        z-index: 50;
        background-position: right -30px;
    }

    .acrossTab li i {
        position: absolute;
        display: block;
        width: 13px;
        height: 13px;
        top: 50%;
        margin-top: -6px;
        right: 5px;
        font-size: 0;
        line-height: 0;
        cursor: pointer;
        background-image: url(/srv/static/panel/images/acrossTab-close.png);
        background-repeat: no-repeat;
        background-position: 0 0;
    }

    .acrossTab li i:hover {
        background-position: 0 -13px;
    }

    .Hui-tabNav .acrossTab li em {
        right: -16px;
        height: 26px;
        width: 16px;
    }

    .Hui-tabNav-wp {
        position: relative;
        height: 35px;
        overflow: hidden;
    }

    .Hui-tabNav .acrossTab {
        position: absolute;
        height: 26px;
        line-height: 26px;
        background: none;
        top: 8px;
        left: 0;
        padding-top: 0;
    }

    .acrossTab {
        height: 29px;
        background-repeat: repeat-x;
        background-position: 0 0;
        padding-top: 1px;
    }

    .acrossTab li {
        position: relative;
        float: left;
        display: inline-block;
        height: 29px;
        line-height: 29px;
        font-size: 12px;
        cursor: pointer;
        padding: 0 30px;
        white-space: nowrap;
        color: #282828;
        background-position: 0 0;
    }

    .Hui-tabNav .acrossTab li {
        height: 26px;
        line-height: 26px;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .Hui-tabNav .acrossTab li label {
        cursor: pointer;
    }

    .acrossTab li.active {
        background-position: 0 -120px;
        z-index: 99;
    }

    .Hui-tabNav-more {
        position: absolute;
        right: 0;
        width: 80px;
        top: -1px;
        display: none;
    }

    /* .btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
         border-bottom-right-radius: 0;
         border-top-right-radius: 0;
     }*/

    /*  a.btn.size-S, span.btn.size-S {
          line-height: 19px;
      }

      .btn.size-S {
          padding: 3px 8px;
      }
  */
    /*   .input-text.size-S, .btn.size-S {
           font-size: 12px;
           height: 27px;
           padding: 3px;
           line-height: 1.42857;
       }*/

    .acrossTab li.active em {
        background-position: right -150px;
    }

    .show_iframe {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
    }

    .show_iframe iframe {
        position: absolute;
        bottom: 0;
        height: 100%;
        width: 100%;
    }

    .loading {
        height: 100px;
        line-height: 100px;
        vertical-align: middle;
        width: 100%;
        text-align: center;
    }

</style>
<div class="inner-nav" style="padding-right: 190px">
    <?php if (!\Util\Ajax::isMobile()) { ?>

        <div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
            <div class="Hui-tabNav-wp">
                <ul id="min_title_list" class="acrossTab cl" style="margin-left: 10px">
                    <!-- <li class="active" data-id="0">
                         <label data-title="控制面板" data-href="/panel" data-id="0">控制面板</label>
                         <em></em>
                     </li>-->
                </ul>
            </div>
            <div class="Hui-tabNav-more" style="display: block;">
                <a id="js-tabNav-prev" class="miBtn" href="javascript:;"><i class="fa fa-angle-left"></i></a>
                <a id="js-tabNav-next" class="miBtn" href="javascript:;"><i class="fa fa-angle-right"></i></a>
            </div>
        </div>
    <?php } ?>
    <!--  <?php
    /*    if ($curMenu) {
            */ ?>
        <em class="leftCore">
            <?php /*echo $topMenuCat['title']; */ ?>
            <i class="fa  fa-angle-right"></i>
            <?php /*echo $curMenuCat['title']; */ ?>
        </em>

        <?php
    /*        foreach ($curMenus as $_menu) {
                $uri = isset($_menu['uri']) ? $_menu['uri'] : '';
                $innerUrl = isset($_menu['is_hide']) && $_menu['is_hide'] ? 'javascript:;' : '/' . $_menu['module'] . '/' . $_menu['controller'] . '/' . $_menu['action'] . $uri;
                $dispay = isset($_menu['is_hide']) && $_menu['is_hide'] ? (($controller == $_menu['controller'] && $action == $_menu['action']) ? '' : 'display:none') : '';
                $current = $_menu['controller'] . '/' . $_menu['action'] == $controller . '/' . $action ? 'active' : '';
                */ ?>
            <span class="<?php /*echo $current; */ ?>" style="<?php /*echo $dispay; */ ?>">
                <a href="<?php /*echo $innerUrl; */ ?>">
                    <?php /*echo $_menu['title']; */ ?>
                </a>
            </span>
            <?php
    /*        }
        } else {
            */ ?>
        <em class="leftCore">
            控制面板
        </em>
    <?php /*} */ ?>
    <em class="right" style="font-style: normal;margin:-5px 5px 0 0;">
        <a href="javascript:history.go(-1);" class="miBtn"><i class="fa fa-arrow-left"></i> 返回</a>
    </em>-->
    <?php if (\Util\Ajax::isMobile()) { ?>
        <em class="leftCore">
            <a href="/srv/panel/">控制面板</a>
        </em>
        <em class="right" style="font-style: normal;margin:-5px 5px 0 0;">
            <a href="javascript:history.go(-1);" class="miBtn"><i class="fa fa-arrow-left"></i> 返回</a>
        </em>
    <?php } ?>

</div>
<?php if (\Util\Ajax::isMobile()) { ?>
    <script>
        /*选项卡导航*/
        $(".subItem").on("click", 'a', function () {
            Hui_admin_tab(this);
        });
        $(document).on("click", '.newTarget', function () {
            Hui_admin_tab(this);
        });
        /*菜单导航*/
        function Hui_admin_tab(obj) {
            window.location.href = $(obj).attr('data-href');
        }
        $(".inner-nav").css({"padding-right": '0'})
    </script>
<?php } else { ?>
    <script>
        var num = 0, oUl = $("#min_title_list"), hide_nav = $("#Hui-tabNav");
        var tabList = localStorage.getItem("tab");
        var has_init = false;
        /*获取顶部选项卡总长度*/
        function tabNavallwidth() {
            var taballwidth = 0,
                $tabNav = hide_nav.find(".acrossTab"),
                $tabNavWp = hide_nav.find(".Hui-tabNav-wp"),
                $tabNavitem = hide_nav.find(".acrossTab li"),
                $tabNavmore = hide_nav.find(".Hui-tabNav-more");
            if (!$tabNav[0]) {
                return
            }
            $tabNavitem.each(function (index, element) {
                taballwidth += Number(parseFloat($(this).width() + 60))
            });
            $tabNav.width(taballwidth + 25);
            var w = $tabNavWp.width();
            if (taballwidth + 25 > w) {
                $tabNavmore.show()
            }
            else {
                $tabNavmore.hide();
                $tabNav.css({left: 0});
            }
        }
        //初始化tab
        function initTab() {

            if (!tabList || tabList == null) {
                tabList = {
                    "/srv/panel/index/welcome": {
                        href: "/srv/panel/index/welcome",
                        title: "控制面板",
                        is_active: 1
                    }
                }
            } else {
                tabList = JSON.parse(tabList);
                if (tabList["/srv/panel/index/welcome"] === undefined) {
                    tabList["/srv/panel/index/welcome"] =
                    {
                        href: "/srv/panel/index/welcome",
                        title: "控制面板",
                        is_active: 1
                    }
                }
            }
            localStorage.setItem("tab", JSON.stringify(tabList));
            var active = {};
            tabList = eval(tabList);
            for (var i in tabList) {
                init_admin_tab(tabList[i]);
                if (tabList[i]['is_active'] == 1) {
                    active = tabList[i];
                }
            }
            //选中
            init_admin_tab(active);

        }
        //初始化 导航
        function init_admin_tab(obj) {
            var bStop = false,
                bStopIndex = 0,
                href = obj.href,
                title = obj.title,
                id = obj.id,
                topWindow = $(window.parent.document),
                show_navLi = topWindow.find("#min_title_list li"),
                iframe_box = topWindow.find("#iframe_box");
            //console.log(topWindow);
            show_navLi.each(function () {
                if ($(this).find('label').attr("data-href") == href) {
                    bStop = true;
                    bStopIndex = show_navLi.index($(this));
                    return false;
                }
            });
            if (!bStop) {
                creatIframe(href, title, id);
                min_titleList();
            }
            else {
                show_navLi.removeClass("active").eq(bStopIndex).addClass("active");
                iframe_box.find(".show_iframe").hide().eq(bStopIndex).show().find("iframe").attr("src", href);
            }
        }
        /*菜单导航*/
        function Hui_admin_tab(obj) {
            var bStop = false,
                bStopIndex = 0,
                href = $(obj).attr('data-href'),
                title = $(obj).attr("data-title"),
                id = $(obj).attr("data-id"),
                topWindow = $(window.parent.document),
                show_navLi = topWindow.find("#min_title_list li"),
                iframe_box = topWindow.find("#iframe_box");
            //console.log(topWindow);
            if (!href || href == "") {
                alert("data-href不存在，v2.5版本之前用_href属性，升级后请改为data-href属性");
                return false;
            }
            if (!title) {
                alert("v2.5版本之后使用data-title属性");
                return false;
            }
            if (title == "") {
                alert("data-title属性不能为空");
                return false;
            }
            show_navLi.each(function () {
                if ($(this).find('label').attr("data-href") == href) {
                    bStop = true;
                    bStopIndex = show_navLi.index($(this));
                    return false;
                }
            });
            if (!bStop) {
                if (tabList && tabList !== null) {
                    for (var i in tabList) {
                        tabList[i]['is_active'] = 0;
                    }
                    tabList[href] = {
                        href: href,
                        title: title,
                        id: id,
                        is_active: 1
                    };
                    localStorage.setItem("tab", JSON.stringify(tabList))
                }
                creatIframe(href, title, id);
                min_titleList();
            }
            else {
                show_navLi.removeClass("active").eq(bStopIndex).addClass("active");
                iframe_box.find(".show_iframe").hide().eq(bStopIndex).show().find("iframe").attr("src", href);
                if (tabList !== null) {
                    for (var i in tabList) {
                        if (tabList[i]['href'] == href) {
                            tabList[i]['is_active'] = 1;
                        } else {
                            tabList[i]['is_active'] = 0;
                        }

                    }
                    tabList["" + href + ""] = {
                        href: href,
                        title: title,
                        id: id,
                        is_active: 1
                    };
                    localStorage.setItem("tab", JSON.stringify(tabList))
                }

            }
        }

        /*最新tab标题栏列表*/
        function min_titleList() {
            var topWindow = $(window.parent.document),
                show_nav = topWindow.find("#min_title_list"),
                aLi = show_nav.find("li");
        }

        /*创建iframe*/
        function creatIframe(href, titleName, id) {
            var topWindow = $(window.parent.document),
                show_nav = topWindow.find('#min_title_list'),
                iframe_box = topWindow.find('#iframe_box'),
                iframeBox = iframe_box.find('.show_iframe'),
                $tabNav = topWindow.find(".acrossTab"),
                $tabNavWp = topWindow.find(".Hui-tabNav-wp"),
                $tabNavmore = topWindow.find(".Hui-tabNav-more");
            var taballwidth = 0;

            show_nav.find('li').removeClass("active");
            if (href != '/srv/panel/index/welcome') {
                show_nav.append('<li class="active"><label data-href="' + href + '">' + titleName + '</label><i></i><em></em></li>');
            } else {
                show_nav.append('<li class="active"><label data-href="' + href + '">' + titleName + '</label><em></em></li>');
            }
            if ('function' == typeof $('#min_title_list li').contextMenu) {
                $("#min_title_list li").contextMenu('Huiadminmenu', {
                    bindings: {
                        'closethis': function (t) {
                            var $t = $(t);
                            if ($t.find("i")) {
                                $t.find("i").trigger("click");
                            }
                        },
                        'closeall': function (t) {
                            $("#min_title_list li i").trigger("click");
                        },
                    }
                });
            } else {

            }

            var $tabNavitem = topWindow.find(".acrossTab li");
            if (!$tabNav[0]) {
                return
            }

            $tabNavitem.each(function (index, element) {
                taballwidth += Number(parseFloat($(this).width() + 60))
            });

            $tabNav.width(taballwidth + 25);
            var w = $tabNavWp.width();
            if (taballwidth + 25 > w) {
                $tabNavmore.show()
            }

            else {
                $tabNavmore.hide();
                $tabNav.css({left: 0})
            }
            iframeBox.hide();
            iframe_box.append('<div class="show_iframe" data-id="' + id + '"><div class="loading"><img src="/srv/static/panel/images/admin/loading2.gif"/></div><iframe allowfullscreen="true" frameborder="0" src=' + href + '></iframe></div>');

            var showBox = iframe_box.find('.show_iframe:visible');

            showBox.find('iframe').on('load', function () {
                showBox.find('.loading').hide();
            });
        }


        /*关闭iframe*/
        function removeIframe() {

            var topWindow = $(window.parent.document),
                iframe = topWindow.find('#iframe_box .show_iframe'),
                tab = topWindow.find(".acrossTab li"),
                showTab = topWindow.find(".acrossTab li.active"),
                showBox = topWindow.find('.show_iframe:visible'),
                i = showTab.index();

            tab.eq(i - 1).addClass("active");

            delete  tabList[tab.eq(i).find('label').attr('data-href')];
            tabList[tab.eq(i - 1).find('label').attr('data-href')]['is_active'] = 1;
            localStorage.setItem("tab", JSON.stringify(tabList));

            tab.eq(i).remove();
            iframe.eq(i - 1).show();
            iframe.eq(i).remove();

        }

        /*关闭所有iframe*/
        function removeIframeAll() {
            var topWindow = $(window.parent.document),
                iframe = topWindow.find('#iframe_box .show_iframe'),
                tab = topWindow.find(".acrossTab li");
            for (var i = 0; i < tab.length; i++) {
                if (tab.eq(i).find("i").length > 0) {
                    tab.eq(i).remove();
                    iframe.eq(i).remove();
                }
            }
        }
        $(function () {

            /*选项卡导航*/
            $(".subItem").on("click", 'a', function () {
                Hui_admin_tab(this);
                $(".subItem").removeClass("active");
                $(this).parent().addClass("active");
            });
            $(document).on("click", "#min_title_list li", function () {
                var bStopIndex = $(this).index();
                var iframe_box = $("#iframe_box");
                $("#min_title_list li").removeClass("active").eq(bStopIndex).addClass("active");
                iframe_box.find(".show_iframe").hide().eq(bStopIndex).show();

                for (var i in tabList) {
                    tabList[i]['is_active'] = 0;
                }
                tabList[$("#min_title_list li").eq(bStopIndex).find("label").attr('data-href')]['is_active'] = 1;

                localStorage.setItem("tab", JSON.stringify(tabList));

                //iframe_box.find(".show_iframe").hide().find("[data-id='"+$(this).attr('data-id')+"']").show();

            });
            $(document).on("click", "#min_title_list li i", function () {

                var aCloseIndex = $(this).parents("li").index();
                if ($(this).siblings("label").attr('data-href') == '/srv/panel/index/welcome') {
                    return;
                }
                delete  tabList[$(this).siblings("label").attr('data-href')];

                $(this).parent().remove();
                $('#iframe_box').find('.show_iframe').eq(aCloseIndex).remove();


                num == 0 ? num = 0 : num--;
                tabNavallwidth();
            });
            $(document).on("dblclick", "#min_title_list li", function () {
                var aCloseIndex = $(this).index();
                var iframe_box = $("#iframe_box");
                if (aCloseIndex > 0) {
                    if ($(this).siblings("label").attr('data-href') == '/srv/panel/index/welcome') {
                        return;
                    }
                    delete  tabList[$(this).find("label").attr('data-href')];
                    tabList[$("#min_title_list li").eq(aCloseIndex - 1).find('label').attr('data-href')]['is_active'] = 1;
                    localStorage.setItem("tab", JSON.stringify(tabList));

                    $(this).remove();
                    $('#iframe_box').find('.show_iframe').eq(aCloseIndex).remove();


                    num == 0 ? num = 0 : num--;

                    for (var i in tabList) {
                        tabList[i]['is_active'] = 0;
                    }
                    $("#min_title_list li").removeClass("active").eq(aCloseIndex - 1).addClass("active");


                    iframe_box.find(".show_iframe").hide().eq(aCloseIndex - 1).show();
                    tabNavallwidth();
                } else {
                    return false;
                }
            });

            tabNavallwidth();

            $('#js-tabNav-next').click(function () {
                num == oUl.find('li').length - 1 ? num = oUl.find('li').length - 1 : num++;
                toNavPos();
            });
            $('#js-tabNav-prev').click(function () {
                num == 0 ? num = 0 : num--;
                toNavPos();
            });
            function toNavPos() {
                oUl.stop().animate({'left': -num * 100}, 100);
            }


            /*  function init() {
             testWebSocket();
             }

             var websocket = null;

             function testWebSocket() {
             var websocket = new WebSocket("ws://112.74.15.30:9503");
             websocket.onopen = function (evt) {
             onOpen(evt)
             };
             websocket.onclose = function (evt) {
             onClose(evt)
             };
             websocket.onmessage = function (evt) {
             onMessage(evt)
             };
             websocket.onerror = function (evt) {
             onError(evt)
             };
             }

             function onOpen(evt) {
             writeToScreen("CONNECTED");
             doSend("WebSocket rocks");
             }

             function onClose(evt) {
             writeToScreen("DISCONNECTED");
             }

             function onMessage(evt) {
             writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data + '</span>');
             websocket.close();
             }

             function onError(evt) {
             writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
             }

             function doSend(message) {
             writeToScreen("SENT: " + message);
             websocket.send(message);
             }

             function writeToScreen(message) {
             console.log(message)
             }

             window.addEventListener("load", init, false);*/

            initTab();
        });

    </script>
<?php } ?>

