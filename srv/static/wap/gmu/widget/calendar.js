/**
 * calendar
 * src/widget/calendar/calendar.js,src/widget/calendar/$picker.js
 **/
!function(a,b,c){var k,d=["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"],e=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],f=/^(\+|\-)?(\d+)(M|Y)$/i,g=function(a,b){return 32-new Date(a,b,32).getDate()},h=function(a,b){return new Date(a,b,1).getDay()},i=function(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c},j=function(a){return a.is("select, input")?a.val():a.attr("data-value")};a.define("Calendar",{options:{date:null,firstDay:1,maxDate:null,minDate:null,swipeable:!1,monthChangeable:!1,yearChangeable:!1},_init:function(){this.on("ready",function(){var a=this._options,c=this._container||this.$el,d=b.proxy(this._eventHandler,this);this.minDate(a.minDate).maxDate(a.maxDate).date(a.date||new Date).refresh(),c.addClass("ui-calendar").on("click",d).highlight(),a.swipeable&&c.on("swipeLeft swipeRight",d)})},_create:function(){var a=this.$el;a||(a=this.$el=b("<div>")),a.appendTo(this._options.container||(a.parent().length?"":document.body))},_eventHandler:function(a){var e,f,g,h,i,d=(this._options,(this._container||this.$el).get(0));switch(a.type){case"swipeLeft":case"swipeRight":return this.switchMonthTo(("swipeRight"==a.type?"-":"+")+"1M");case"change":return i=b(".ui-calendar-header .ui-calendar-year, .ui-calendar-header .ui-calendar-month",this._el),this.switchMonthTo(j(i.eq(1)),j(i.eq(0)));default:f=a.target,(e=b(f).closest(".ui-calendar-calendar tbody a",d))&&e.length?(a.preventDefault(),g=e.parent(),this._option("selectedDate",h=new Date(g.attr("data-year"),g.attr("data-month"),e.text())),this.trigger("select",h,b.calendar.formatDate(h),this),this.refresh()):(e=b(f).closest(".ui-calendar-prev, .ui-calendar-next",d))&&e.length&&(a.preventDefault(),this.switchMonthTo((e.is(".ui-calendar-prev")?"-":"+")+"1M"))}},_option:function(a,d){var g,h,e=this._options;if(d!==c){switch(a){case"minDate":case"maxDate":e[a]=d?b.calendar.parseDate(d):null;break;case"selectedDate":g=e.minDate,h=e.maxDate,d=b.calendar.parseDate(d),d=g&&g>d?g:h&&d>h?h:d,e._selectedYear=e._drawYear=d.getFullYear(),e._selectedMonth=e._drawMonth=d.getMonth(),e._selectedDay=d.getDate();break;case"date":this._option("selectedDate",d),e[a]=this._option("selectedDate");break;default:e[a]=d}return e._invalid=!0,this}return"selectedDate"==a?new Date(e._selectedYear,e._selectedMonth,e._selectedDay):e[a]},switchToToday:function(){var a=new Date;return this.switchMonthTo(a.getMonth(),a.getFullYear())},switchMonthTo:function(a,b){var g,h,i,c=this._options,d=this.minDate(),e=this.maxDate();return"[object String]"===Object.prototype.toString.call(a)&&f.test(a)?(g="-"==RegExp.$1?-parseInt(RegExp.$2,10):parseInt(RegExp.$2,10),h=RegExp.$3.toLowerCase(),a=c._drawMonth+("m"==h?g:0),b=c._drawYear+("y"==h?g:0)):(a=parseInt(a,10),b=parseInt(b,10)),i=new Date(b,a,1),i=d&&d>i?d:e&&i>e?e:i,a=i.getMonth(),b=i.getFullYear(),(a!=c._drawMonth||b!=c._drawYear)&&(this.trigger("monthchange",c._drawMonth=a,c._drawYear=b,this),c._invalid=!0,this.refresh()),this},refresh:function(){var a=this._options,c=this._container||this.$el,d=b.proxy(this._eventHandler,this);if(a._invalid)return b(".ui-calendar-calendar td:not(.ui-state-disabled), .ui-calendar-header a",c).highlight(),b(".ui-calendar-header select",c).off("change",d),c.empty().append(this._generateHTML()),b(".ui-calendar-calendar td:not(.ui-state-disabled), .ui-calendar-header a",c).highlight("ui-state-hover"),b(".ui-calendar-header select",c).on("change",d),a._invalid=!1,this},destroy:function(){var a=this._container||this.$el,c=this._eventHandler;return b(".ui-calendar-calendar td:not(.ui-state-disabled)",a).highlight(),b(".ui-calendar-header select",a).off("change",c),a.remove(),this.$super("destroy")},_generateHTML:function(){var m,n,o,p,q,r,s,t,a=this._options,b=a._drawYear,c=a._drawMonth,d=new Date,f=new Date(d.getFullYear(),d.getMonth(),d.getDate()),i=this.minDate(),j=this.maxDate(),k=this.selectedDate(),l="";for(o=isNaN(o=parseInt(a.firstDay,10))?0:o,l+=this._renderHead(a,b,c,i,j)+'<table  class="ui-calendar-calendar"><thead><tr>',m=0;7>m;m++)p=(m+o)%7,l+="<th"+((m+o+6)%7>=5?' class="ui-calendar-week-end"':"")+">"+"<span>"+e[p]+"</span></th>";for(l+='</thead></tr><tbody><tr class="ui-calendar-gap"><td colspan="7">&#xa0;</td></tr>',r=g(b,c),q=(h(b,c)-o+7)%7,s=Math.ceil((q+r)/7),t=new Date(b,c,1-q),m=0;s>m;m++){for(l+="<tr>",n=0;7>n;n++)l+=this._renderDay(n,t,o,c,k,f,i,j),t.setDate(t.getDate()+1);l+="</tr>"}return l+="</tbody></table>"},_renderHead:function(a,b,c,e,f){var j,k,g='<div class="ui-calendar-header">',h=new Date(b,c,-1),i=new Date(b,c+1,1);if(g+='<a class="ui-calendar-prev'+(e&&e>h?" ui-state-disable":"")+'" href="#">&lt;&lt;</a><div class="ui-calendar-title">',a.yearChangeable){for(g+='<select class="ui-calendar-year">',j=Math.max(1970,b-10),k=j+20;k>j;j++)g+='<option value="'+j+'" '+(j==b?'selected="selected"':"")+">"+j+"\u5e74</option>";g+="</select>"}else g+='<span class="ui-calendar-year" data-value="'+b+'">'+b+"\u5e74"+"</span>";if(a.monthChangeable){for(g+='<select class="ui-calendar-month">',j=0;12>j;j++)g+='<option value="'+j+'" '+(j==c?'selected="selected"':"")+">"+d[j]+"</option>";g+="</select>"}else g+='<span class="ui-calendar-month" data-value="'+c+'">'+d[c]+"</span>";return g+='</div><a class="ui-calendar-next'+(f&&i>f?" ui-state-disable":"")+'" href="#">&gt;&gt;</a></div>'},_renderDay:function(a,b,c,d,e,f,g,h){var j,i=b.getMonth()!==d;return j=i||g&&g>b||h&&b>h,"<td class='"+((a+c+6)%7>=5?"ui-calendar-week-end":"")+(j?" ui-calendar-unSelectable ui-state-disabled":"")+(i||j?"":(b.getTime()===e.getTime()?" ui-calendar-current-day":"")+(b.getTime()===f.getTime()?" ui-calendar-today":""))+"'"+(j?"":" data-month='"+b.getMonth()+"' data-year='"+b.getFullYear()+"'")+">"+(i?"&#xa0;":j?"<span class='ui-state-default'>"+b.getDate()+"</span>":"<a class='ui-state-default"+(b.getTime()===f.getTime()?" ui-state-highlight":"")+(b.getTime()===e.getTime()?" ui-state-active":"")+"' href='#'>"+b.getDate()+"</a>")+"</td>"}}),k=a.Calendar.prototype,b.each(["maxDate","minDate","date","selectedDate"],function(a,b){k[b]=function(a){return this._option(b,a)}}),b.calendar={parseDate:function(a){var b=/^(\d{4})(?:\-|\/)(\d{1,2})(?:\-|\/)(\d{1,2})$/;return"[object Date]"===Object.prototype.toString.call(a)?a:b.test(a)?new Date(parseInt(RegExp.$1,10),parseInt(RegExp.$2,10)-1,parseInt(RegExp.$3,10)):null},formatDate:function(a){return a.getFullYear()+"-"+i(a.getMonth()+1,2)+"-"+i(a.getDate(),2)}}}(gmu,gmu.$);
