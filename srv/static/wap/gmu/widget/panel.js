/**
 * @file 导航栏组件
 * @import src/widget/panel/panel.js
 */
/**
 * @file panel组件
 * @import extend/touch.js, core/widget.js, extend/throttle.js, extend/event.scrollStop.js, extend/event.ortchange.js
 * @module GMU
 */
!function(a,b){var d=b.fx.cssPrefix,e=b.fx.transitionEnd;a.define("Panel",{options:{contentWrap:"",scrollMode:"follow",display:"push",position:"right",dismissible:!0,swipeClose:!0},_init:function(){var a=this,c=a._options;a.on("ready",function(){a.displayFn=a._setDisplay(),a.$contentWrap.addClass("ui-panel-animate"),a.$el.on(e,b.proxy(a._eventHandler,a)).hide(),c.dismissible&&a.$panelMask.hide().on("click",b.proxy(a._eventHandler,a)),"follow"!==c.scrollMode&&b(window).on("scrollStop",b.proxy(a._eventHandler,a)),b(window).on("ortchange",b.proxy(a._eventHandler,a))})},_create:function(){if(!this._options.setup)throw new Error("panel\u7ec4\u4ef6\u4e0d\u652f\u6301create\u6a21\u5f0f\uff0c\u8bf7\u4f7f\u7528setup\u6a21\u5f0f");var a=this,c=a._options,d=a.$el.addClass("ui-panel ui-panel-"+c.position);a.panelWidth=d.width()||0,a.$contentWrap=b(c.contentWrap||d.next()),c.dismissible&&(a.$panelMask=b('<div class="ui-panel-dismiss"></div>').width(document.body.clientWidth-d.width()).appendTo("body")||null)},_setDisplay:function(){var i,j,a=this,c=a.$el,e=a.$contentWrap,f=d+"transform",g=a._transDisplayToPos(),h={};return b.each(["push","overlay","reveal"],function(b,d){h[d]=function(b,h,k){return i=g[d].panel,j=g[d].cont,c.css(f,"translate3d("+a._transDirectionToPos(h,i[b])+"px,0,0)"),k||(e.css(f,"translate3d("+a._transDirectionToPos(h,j[b])+"px,0,0)"),a.maskTimer=setTimeout(function(){a.$panelMask&&a.$panelMask.css(h,c.width()).toggle(b)},400)),a}}),h},_initPanelPos:function(a,b){return this.displayFn[a](0,b,!0),this.$el.get(0).clientLeft,this},_transDirectionToPos:function(a,b){return"left"===a?b:-b},_transDisplayToPos:function(){var a=this,b=a.panelWidth;return{push:{panel:[-b,0],cont:[0,b]},overlay:{panel:[-b,0],cont:[0,0]},reveal:{panel:[0,0],cont:[0,b]}}},_setShow:function(a,c,d){var e=this,f=e._options,g=a?"open":"close",h=b.Event("before"+g),i=a!==e.state(),j=a?"on":"off",k=a?b.proxy(e._eventHandler,e):e._eventHandler,l=c||f.display,m=d||f.position;return e.trigger(h,[c,d]),h.isDefaultPrevented()?e:(i&&(e._dealState(a,l,m),e.displayFn[l](e.isOpen=Number(a),m),f.swipeClose&&e.$el[j](b.camelCase("swipe-"+m),k),f.display=l,f.position=m),e)},_dealState:function(a,c,d){var f=this,g=f._options,h=f.$el,i=f.$contentWrap,j="ui-panel-"+c+" ui-panel-"+d,k="ui-panel-"+g.display+" ui-panel-"+g.position+" ui-panel-animate";return a&&(h.removeClass(k).addClass(j).show(),"fix"===g.scrollMode&&h.css("top",b(window).scrollTop()),f._initPanelPos(c,d),"reveal"===c?i.addClass("ui-panel-contentWrap").on(e,b.proxy(f._eventHandler,f)):(i.removeClass("ui-panel-contentWrap").off(e,b.proxy(f._eventHandler,f)),h.addClass("ui-panel-animate")),f.$panelMask&&f.$panelMask.css({left:"auto",right:"auto",height:document.body.clientHeight})),f},_eventHandler:function(a){var c=this,d=c._options,f=d.scrollMode,g=c.state()?"open":"close";switch(a.type){case"click":case"swipeLeft":case"swipeRight":c.close();break;case"scrollStop":"fix"===f?c.$el.css("top",b(window).scrollTop()):c.close();break;case e:c.trigger(g,[d.display,d.position]);break;case"ortchange":c.$panelMask&&c.$panelMask.css("height",document.body.clientHeight),"fix"===f&&c.$el.css("top",b(window).scrollTop())}},open:function(a,b){return this._setShow(!0,a,b)},close:function(){return this._setShow(!1)},toggle:function(a,b){return this[this.isOpen?"close":"open"](a,b)},state:function(){return!!this.isOpen},destroy:function(){return this.$panelMask&&this.$panelMask.off().remove(),this.maskTimer&&clearTimeout(this.maskTimer),this.$contentWrap.removeClass("ui-panel-animate"),b(window).off("scrollStop",this._eventHandler),b(window).off("ortchange",this._eventHandler),this.$super("destroy")}})}(gmu,gmu.$);