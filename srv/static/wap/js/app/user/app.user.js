define(function(require,exports){function e(t,i){var n=$("#"+t);if(n)if(i&&i>0){n.addClass("btn-disabled"),60==i&&(n.removeClass("btn-green"),n.addClass("btn-gray"));var a=i-1;n.html("等待"+a+"秒"),setTimeout(function(){e(t,i-1)},1e3)}else n.removeClass("btn-disabled"),n.html("重发验证码")}function t(e,t,i,n){i=i||2e3,$(e).prev().css("visibility","visible").html(t),setTimeout(function(){$(e).prev().css("visibility","hidden")},i),"function"==typeof n&&n()}var i=require("base"),n=require("app/more"),a=require("app/ps.init"),s=require("app/user/app.upload"),o=require("/static/wap/js/cryptKLG.js");exports.user_center=function(e){var t=!1,i=!1,s=!1;$(".tab_list li").on("click",function(){var o=$(this).data("id");$(".tab_content").hide(),$(".tab_content[data-id='"+o+"']").show(),$(this).addClass("on").siblings().removeClass("on"),2!=o||t||n.more("/api/user/discuss",{to:e},function(){t=!0,a.init()},"#discuss_wrap",".item"),3!=o||i||n.more("/api/user/album",{to:e},function(){i=!0,a.init()},"#album_wrap",".album_list_item",{amount:5}),4!=o||s||n.more("/api/user/show",{uid:e},function(){s=!0,0===$("#show_wrap > div.item").length&&$("#no-video").show()},"#show_wrap",".item")}),$(document).on("click",".rent li",function(){window.location.href="/user/skillInfo?skill="+$(this).data("data")+"&info="+$(this).data("info")}),$(".tab_list li[data-id='1']").click()},exports.send_code=function(n,a){$("#sendCodeBtn").on("click",function(s){var r=a.find(".phone").val(),d=a.find(".state-code").val();if(!/^1\d{10}$/.test(r))return a.find(".phone").focus(),t($(".next-2"),"请输入正确的手机号码"),!1;if($(this).hasClass("btn-disabled"))t($(".next-2"),"一分钟只能发送一次");else{var l=$(this).attr("data-checkUnique"),c=$(this).attr("disabled");if(c&&"true"==c)return!1;n&&"null"!==n||(n="");var u=o.encrypt({phone:r,check_unique:l,state_code:d,type:n});i.requestApi("/api/sms/sendPhoneVerifyCode",{params:u},function(i){1==i.result?e("sendCodeBtn",60):1016==i.error.code?t($(".next-2"),"该手机号已注册"):console.log(i.error)},!1,!0,$(".step-2 .err")),s.stopImmediatePropagation()}})},exports.register=function(){function e(e,n){var a=o.serializeObject();!0!==n&&(void 0!==e&&""!=e||t($(".next-2"),"头像上传失败")),a.avatar=e,i.requestApi("/api/user/reg",a,function(e){1==e.result&&($("#page-3").slideUp(),$("#page-4").slideDown())},!1,!0,$(".step-3 .err"))}var n=function(){var e=new Date;return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()},a="",o=$(".regForm");exports.send_code("register",o),$(".next-1").on("click",function(){$(".step-1").slideUp(),$(".step-2").slideDown()}),$(".next-2").on("click",function(){if($(".agree input").is(":checked")){var n=$("#code").val(),o=$("#phone").val(),r=$("#pwd").val();/^1[\d]{10}$/.test(o)?""!=n&&void 0!=n?/^(\d){6}$/.test(n)?""!=r&&void 0!=r?/^[0-9a-zA-Z]{6,16}$/g.test(r)?i.requestApi("/api/user/ValidateCode",{code:n,phone:o},function(i){1==i.result?($(".step-2").slideUp(),$(".step-3").slideDown(),s.uploadAvatar('.upload-widget[data-unique="1"]',{type:"img"},function(e){a=e},e)):1039==i.error.code&&t($(".next-2"),"验证码未发送或者已过期,请重新发送")},!1,!0,$(".step-2 .err")):t($(".next-2"),"密码为6-16位数字或字母"):t($(".next-2"),"请输入密码"):t($(".next-2"),"验证码为6位数字"):t($(".next-2"),"请输入验证码"):t($(".next-2"),"请输入正确手机号")}else t(this,"请阅读并同意注册协议")}),$(".regBtn").on("click",function(){o.serializeObject(),$("#avatar").attr("src");var i=$("#username").val().trim(),s=$("#birthday").val().replace(/-/g,"/");""==i||void 0===i||i.length<2||i.length>8?t($(".regBtn"),"用户名为2-8位"):""!=s&&void 0!==s?new Date(n()).getTime()-new Date(s).getTime()<=0?t($(".regBtn"),"请选择正确的生日"):void 0!==$("#avatar").attr("data-width")?a.start():e("",!0):t($(".regBtn"),"请选择出生日期")}),$("#eye_toggle").on("click",function(){var e=this;$(e).attr("data-stat");$(e).find("img").each(function(){$(this).toggleClass("hide")}),"open"==$(e).find("img:visible").attr("data-stat")?$(e).prev().attr("type","text"):$(e).prev().attr("type","password")})}});